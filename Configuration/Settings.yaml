Flowpack:
  ElasticSearch:
    ContentRepositoryAdaptor:
      command:
        useSubProcesses: false
      indexing:
        batchSize:
          elements: 500
          octets: 40000000
      configuration:
        nodeTypes:
          '*':
            indexed: true
      driver:
        version: '6.x'
        mapping:
          6.x:
            query:
              className: Flowpack\ElasticSearch\ContentRepositoryAdaptor\Driver\Version6\Query\FilteredQuery
              arguments:
                request:
                  query:
                    bool:
                      must:
                        - match_all:
                            boost: 1.0 # force match_all to be an object
                      filter:
                        bool:
                          must: []
                          should: []
                          must_not:
                            - term:
                                _hidden: true
                            - range:
                                _hiddenBeforeDateTime:
                                  gt: now
                            - range:
                                _hiddenAfterDateTime:
                                  lt: now
                  _source:
                    - '__path'
                unsupportedFieldsInCountRequest:
                  - '_source'
                  - 'sort'
                  - 'from'
                  - 'size'
                  - 'highlight'
                  - 'aggs'
                  - 'aggregations'
                  - 'suggest'

            pipelineManagement:
              className: 'Flowpack\ElasticSearch\ContentRepositoryAdaptor\Driver\Version6\PipelineDriver'
              arguments:
                pipelineConfigurations:
                  neos_contentrepository:
                    enabled: false
                    configuration:
                      description: 'Pipeline to ingest attachments using the ingest-attachment plugin'
                      processors:
                        -
                          attachment:
                            field: neos_asset
                            indexed_chars: 100000
                            ignore_missing: true
                        -
                          script:
                            lang: painless
                            source: >
                              if (ctx.containsKey("attachment")) {
                                 if (!ctx.containsKey("__fulltext") || !(ctx.__fulltextParts instanceof Map)) {
                                   ctx.__fulltext = new HashMap();
                                 }
                                 ctx.__fulltext.text = ctx.__fulltext.text + ' ' + ctx.attachment.content
                               }
                        -
                          remove:
                            field:
                              - attachment
                              - neos_asset
                            ignore_missing: true

            document:
              className: 'Flowpack\ElasticSearch\ContentRepositoryAdaptor\Driver\Version6\DocumentDriver'
            indexer:
              className: 'Flowpack\ElasticSearch\ContentRepositoryAdaptor\Driver\Version6\IndexerDriver'
            indexManagement:
              className: 'Flowpack\ElasticSearch\ContentRepositoryAdaptor\Driver\Version6\IndexDriver'
            request:
              className: 'Flowpack\ElasticSearch\ContentRepositoryAdaptor\Driver\Version6\RequestDriver'
            system:
              className: 'Flowpack\ElasticSearch\ContentRepositoryAdaptor\Driver\Version6\SystemDriver'
            nodeTypeMappingBuilder:
              className: 'Flowpack\ElasticSearch\ContentRepositoryAdaptor\Driver\Version6\Mapping\NodeTypeMappingBuilder'
